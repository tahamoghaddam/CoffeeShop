<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order Monitor</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    :root {
      --default-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft Yahei UI", "Microsoft Yahei", "Source Han Sans CN", sans-serif;
      --primary-background: #FFFFFF;
      --button-background: #A97F61;
      --button-text-color: #FFFFFF;
      --sidebar-background: rgba(217, 217, 217, 0.5);
      --menu-background: #A97F61;
      --menu-text-color: #000000;
      --content-background: rgba(217, 217, 217, 0.4);
      --dropdown-background: #EBE0D9;
      --dropdown-hover-background: #A97F61;
      --form-background: #F8F8F8;
      --form-border-color: #DDDDDD;
      --form-border-radius: 8px;
      --form-padding: 15px;
      --form-margin: 10px 0;
    }

    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      font-family: 'Inter', var(--default-font-family);
    }

    .main-container {
      position: relative;
      width: 1450px;
      height: 880px;
      background: var(--primary-background);
      margin: 0 auto;
    }

    .rectangle-82 {
      position: absolute;
      width: 1450px;
      height: 120px;
      top: 0;
      background: rgba(224, 193, 147, 0.42);
    }

    .mingcute-exit-line {
      position: absolute;
      width: 57px;
      height: 46px;
      left: 30px;
      bottom: 100px; /* Adjusted for placement */
    }

    .sidebar {
      position: absolute;
      width: 273px;
      height: 760px;
      left: 1177px;
      top: 120px;
      background: var(--sidebar-background);
    }

    .menu-item {
      background: var(--menu-background);
      color: var(--menu-text-color);
      display: block;
      text-align: center;
      text-decoration: none;
      font-family: 'Inter';
      width: 100%;
      padding: 20px 0;
      border-bottom: 1px solid var(--menu-background);
      box-sizing: border-box;
    }

    .menu-item:hover {
      background-color: var(--dropdown-hover-background);
      color: var(--menu-text-color);
    }

    .content {
      position: absolute;
      width: 1043px;
      height: 659px;
      left: 59px;
      top: 168px;
      background: var(--content-background);
      padding: 20px;
      box-sizing: border-box;
    }

    .rectangle-86 {
      width: 100%;
      height: calc(100% - 300px); /* Adjusted height to fit content */
      background: var(--dropdown-background);
      border-radius: var(--form-border-radius);
      padding: var(--form-padding);
      box-sizing: border-box;
    }

    .filter-options {
      background: var(--form-background);
      border: 1px solid var(--form-border-color);
      border-radius: var(--form-border-radius);
      padding: var(--form-padding);
      box-sizing: border-box;
      margin-bottom: var(--form-margin);
    }

    .filter-options label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }

    .filter-options select,
    .filter-options input[type="date"],
    .filter-options button {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--form-border-color);
      border-radius: var(--form-border-radius);
      margin-bottom: 10px;
      box-sizing: border-box;
      font-size: 16px;
    }

    .filter-options button {
      background: var(--button-background);
      color: var(--button-text-color);
      border: none;
      cursor: pointer;
      font-size: 18px;
      transition: background-color 0s; /* No color change on hover */
    }

    .back-button {
      position: absolute;
      top: 20px;
      left: 20px;
      background: var(--button-background);
      color: var(--button-text-color);
      border: none;
      border-radius: 5px;
      padding: 10px 20px;
      cursor: pointer;
      text-decoration: none;
      font-size: 16px;
      text-align: center;
      display: inline-block;
    }

    .back-button:hover {
      background-color: darken(var(--button-background), 10%);
    }
  </style>
</head>
<body>
  <div class="main-container">
    <!-- Back Button -->
    <a href="{% url 'admin_page' %}" class="back-button">Back</a>

    <!-- Header Rectangle -->
    <div class="rectangle-82"></div>

    <!-- Mingcute Exit Line -->
    <div class="mingcute-exit-line"></div>

    <!-- Sidebar -->
    <div class="sidebar">
      <a href="{% url 'inventory' %}" class="menu-item">Inventory Control</a>
      <a href="{% url 'addproduct' %}" class="menu-item">Add Product</a>
    </div>

    <!-- Content Area -->
    <div class="content">
      <form method="GET" id="filter-form">
        <div class="filter-options">
          <label for="product_id">Product:</label>
          <select name="product_id" id="product_id">
            <option value="">All</option>
            {% for product in products %}
              <option value="{{ product.id }}">{{ product.name }}</option>
            {% endfor %}
          </select>
          <label for="start_date">Start Date:</label>
          <input type="date" name="start_date" id="start_date">
          <label for="end_date">End Date:</label>
          <input type="date" name="end_date" id="end_date">
          <button type="submit">Filter</button>
        </div>
      </form>

      <div class="rectangle-86">
        <canvas id="orderChart"></canvas>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      function fetchOrderData(filterType) {
        let url = '/get-orders-data/';
        if (filterType !== 'custom') {
          url += `?filter=${filterType}`;
        }

        $.getJSON(url, function(data) {
          updateChart(data.labels, data.data);
        });
      }

      function updateChart(labels, data) {
        const ctx = document.getElementById('orderChart').getContext('2d');
        if (window.orderChart) {
          window.orderChart.destroy();
        }
        window.orderChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: '# of Orders',
              data: data,
              backgroundColor: 'rgba(75, 192, 192, 0.2)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      }

      fetchOrderData(); // Fetch initial data
    });
  </script>
</body>
</html>
